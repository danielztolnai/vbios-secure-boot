This code comes from https://www.linuxdays.cz/2018/video/Radek_Zajic-UEFI_dobry_sluha_nebo_spatny_pan.pdf
All credit goes to the author.
